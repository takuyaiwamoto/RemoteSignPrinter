<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Video Player</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }
    
    #videoContainer {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    
    video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    #controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      padding: 10px 20px;
      border-radius: 5px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    button {
      padding: 8px 16px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    button:hover {
      background: #45a049;
    }
    
    button:disabled {
      background: #666;
      cursor: not-allowed;
    }
    
    #status {
      color: white;
      margin-left: 20px;
      font-family: sans-serif;
    }
    
    #timeDisplay {
      color: white;
      margin-left: 10px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div id="videoContainer">
    <video id="signVideo" src="./signVideoG.mp4"></video>
    <div id="controls">
      <button id="playBtn" onclick="playVideo()">å†ç”Ÿ</button>
      <button id="pauseBtn" onclick="pauseVideo()" style="display:none;">ä¸€æ™‚åœæ­¢</button>
      <button id="resetBtn" onclick="resetVideo()">ãƒªã‚»ãƒƒãƒˆ</button>
      <span id="timeDisplay">0:00 / 0:00</span>
      <span id="status">æº–å‚™å®Œäº†</span>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');
    const video = document.getElementById('signVideo');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const status = document.getElementById('status');
    const timeDisplay = document.getElementById('timeDisplay');
    
    let isWaitingForDraw = false;
    let isWaitingForSend = false;
    let isWaitingForAnimation = false;
    let hasPassedDrawPoint = false;  // 10ç§’åœ°ç‚¹ã‚’é€šéæ¸ˆã¿ã‹ã©ã†ã‹
    let hasPassedSendPoint = false;  // 22ç§’åœ°ç‚¹ã‚’é€šéæ¸ˆã¿ã‹ã©ã†ã‹
    let hasPassedAnimationPoint = false;  // 24ç§’åœ°ç‚¹ã‚’é€šéæ¸ˆã¿ã‹ã©ã†ã‹
    
    // æ™‚é–“è¡¨ç¤ºã®æ›´æ–°
    function updateTimeDisplay() {
      const current = Math.floor(video.currentTime);
      const duration = Math.floor(video.duration) || 0;
      const currentMin = Math.floor(current / 60);
      const currentSec = current % 60;
      const durationMin = Math.floor(duration / 60);
      const durationSec = duration % 60;
      
      timeDisplay.textContent = `${currentMin}:${currentSec.toString().padStart(2, '0')} / ${durationMin}:${durationSec.toString().padStart(2, '0')}`;
    }
    
    // ãƒ“ãƒ‡ã‚ªã®æ™‚é–“æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆ
    video.addEventListener('timeupdate', () => {
      updateTimeDisplay();
      const currentTime = video.currentTime;
      
      // 10.5ç§’ã§è‡ªå‹•ä¸€æ™‚åœæ­¢ï¼ˆæ›¸ãæ‰‹ã®æç”»å¾…ã¡ï¼‰- ä¸€åº¦ã ã‘å®Ÿè¡Œ
      if (currentTime >= 10.5 && currentTime < 11 && !isWaitingForDraw && !hasPassedDrawPoint && video.playing) {
        pauseVideo();
        isWaitingForDraw = true;
        status.textContent = 'æ›¸ãæ‰‹ã®æç”»ã‚’å¾…æ©Ÿä¸­...';
        console.log('ğŸ¬ 10.5ç§’: æ›¸ãæ‰‹ã®æç”»å¾…æ©Ÿé–‹å§‹');
      }
      
      // 21ç§’ã§è‡ªå‹•ä¸€æ™‚åœæ­¢ï¼ˆæ¸¡ã™ãƒœã‚¿ãƒ³å¾…ã¡ï¼‰- ä¸€åº¦ã ã‘å®Ÿè¡Œ
      if (currentTime >= 21 && currentTime < 21.5 && !isWaitingForSend && !hasPassedSendPoint && video.playing) {
        pauseVideo();
        isWaitingForSend = true;
        status.textContent = 'æ¸¡ã™ãƒœã‚¿ãƒ³ã‚’å¾…æ©Ÿä¸­...';
        console.log('ğŸ¬ 21ç§’: æ¸¡ã™ãƒœã‚¿ãƒ³å¾…æ©Ÿé–‹å§‹');
      }
      
      // 24ç§’ã§ã®ä¸€æ™‚åœæ­¢ã¯å‰Šé™¤ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰
      // if (currentTime >= 24 && currentTime < 24.5 && !isWaitingForAnimation && !hasPassedAnimationPoint && video.playing) {
      //   pauseVideo();
      //   isWaitingForAnimation = true;
      //   status.textContent = 'ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¾…æ©Ÿä¸­...';
      //   console.log('ğŸ¬ 24ç§’: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾…æ©Ÿé–‹å§‹');
      // }
    });
    
    // ãƒ“ãƒ‡ã‚ªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†
    video.addEventListener('loadedmetadata', () => {
      updateTimeDisplay();
    });
    
    // å†ç”ŸçŠ¶æ…‹ã®ç®¡ç†
    Object.defineProperty(video, 'playing', {
      get: function() {
        return !!(this.currentTime > 0 && !this.paused && !this.ended && this.readyState > 2);
      }
    });
    
    // å†ç”Ÿé–¢æ•°
    function playVideo() {
      video.play();
      playBtn.style.display = 'none';
      pauseBtn.style.display = 'inline-block';
      status.textContent = 'å†ç”Ÿä¸­';
    }
    
    // ä¸€æ™‚åœæ­¢é–¢æ•°
    function pauseVideo() {
      video.pause();
      playBtn.style.display = 'inline-block';
      pauseBtn.style.display = 'none';
      if (!isWaitingForDraw && !isWaitingForSend && !isWaitingForAnimation) {
        status.textContent = 'ä¸€æ™‚åœæ­¢';
      }
    }
    
    // ãƒªã‚»ãƒƒãƒˆé–¢æ•°
    function resetVideo() {
      video.currentTime = 0;
      pauseVideo();
      isWaitingForDraw = false;
      isWaitingForSend = false;
      isWaitingForAnimation = false;
      hasPassedDrawPoint = false;
      hasPassedSendPoint = false;
      hasPassedAnimationPoint = false;
      status.textContent = 'æº–å‚™å®Œäº†';
      console.log('ğŸ¬ å‹•ç”»ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
    }
    
    // IPCã‹ã‚‰ã®ã‚³ãƒãƒ³ãƒ‰å—ä¿¡
    ipcRenderer.on('video-command', (event, data) => {
      console.log('ğŸ¬ ã‚³ãƒãƒ³ãƒ‰å—ä¿¡:', data);
      
      switch(data.command) {
        case 'play':
          playVideo();
          break;
          
        case 'pause':
          pauseVideo();
          break;
          
        case 'reset':
          resetVideo();
          break;
          
        case 'drawingStarted':
          if (isWaitingForDraw) {
            isWaitingForDraw = false;
            hasPassedDrawPoint = true;  // 10ç§’åœ°ç‚¹ã‚’é€šéæ¸ˆã¿ã¨ãƒãƒ¼ã‚¯
            status.textContent = 'æç”»æ¤œå‡º - å†ç”Ÿå†é–‹';
            playVideo();
            console.log('ğŸ¬ æç”»é–‹å§‹ã‚’æ¤œå‡ºã€å†ç”Ÿå†é–‹');
          }
          break;
          
        case 'sendButtonPressed':
          if (isWaitingForSend) {
            isWaitingForSend = false;
            hasPassedSendPoint = true;  // 22ç§’åœ°ç‚¹ã‚’é€šéæ¸ˆã¿ã¨ãƒãƒ¼ã‚¯
            status.textContent = 'æ¸¡ã™ãƒœã‚¿ãƒ³æ¤œå‡º - æœ€å¾Œã¾ã§å†ç”Ÿ';
            playVideo();
            console.log('ğŸ¬ æ¸¡ã™ãƒœã‚¿ãƒ³æŠ¼ä¸‹ã‚’æ¤œå‡ºã€æœ€å¾Œã¾ã§å†ç”Ÿ');
            
            // å‹•ç”»çµ‚äº†ã¾ã§å†ç”Ÿã‚’ç¶šã‘ã‚‹
            video.addEventListener('ended', () => {
              status.textContent = 'å†ç”Ÿå®Œäº†';
              playBtn.style.display = 'inline-block';
              pauseBtn.style.display = 'none';
            }, { once: true });
          }
          break;
          
        case 'animationStarted':
          // 24ç§’ã§ã®ä¸€æ™‚åœæ­¢ã¯ç„¡åŠ¹åŒ–ã—ãŸãŸã‚ã€ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ç„¡è¦–
          console.log('ğŸ¬ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ï¼ˆç„¡è¦–ï¼‰');
          break;
      }
    });
    
    console.log('ğŸ¬ Sign Video Player åˆæœŸåŒ–å®Œäº†');
  </script>
</body>
</html>